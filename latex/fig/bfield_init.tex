%----------------------------------------------------------------------------------------
% bfield_init.tex
% 3D Plot of initial magnetic field
%----------------------------------------------------------------------------------------
\tdplotsetmaincoords{120}{60}
%% \tdplotsetmaincoords{120}{60}
\begin{tikzpicture}[tdplot_main_coords,scale = 3.0,
    %Option for nice arrows
    >=stealth, %
    inner sep=0pt, outer sep=2pt,%
    axis/.style={thick,->},
    wave/.style={thick,color=#1,smooth},
    polaroid/.style={fill=black!60!white, opacity=0.3},
    %% three sided/.style={
    %% draw=none,
    %% append after command={
    %% [shorten <= -0.5\pgflinewidth]
    %% ([shift={(-1.5\pgflinewidth,-0.5\pgflinewidth)}]\tikzlastnode.north east)
    %% edge([shift={( 0.5\pgflinewidth,-0.5\pgflinewidth)}]\tikzlastnode.north west)
    %% ([shift={( 0.5\pgflinewidth,-0.5\pgflinewidth)}]\tikzlastnode.north west)
    %% edge([shift={( 0.5\pgflinewidth,+0.5\pgflinewidth)}]\tikzlastnode.south west)
    %% ([shift={( 0.5\pgflinewidth,+0.5\pgflinewidth)}]\tikzlastnode.south west)
    %% edge([shift={(-1.0\pgflinewidth,+0.5\pgflinewidth)}]\tikzlastnode.south east)
    %% }
    %% }
]

  % Colors
  \colorlet{darkblue}{blue!50!black}
  \colorlet{lightblue}{blue!80!black}
  \colorlet{darkgreen}{green!50!black}
  \colorlet{lightgreen}{green!80!black}
  \colorlet{darkred}{red!50!black}
  \colorlet{lightred}{red!80!black}

  % Frame
  \coordinate (O) at (0, 0, 0);
  \draw[axis] (O) -- +(1.3 , 0, 0) node [right] {$B_n$};
  \draw[thick] (O) -- +(-1.3 , 0, 0);
  \draw[axis] (O) -- +(0, 1.3, 0) node [right] {$B_y$};
  \draw[axis] (O) -- +(0, -1.3, 0);
  \draw[axis] (O) -- +(0, 0, 1.3) node [above] {$B_z$};
  %% \draw[axis] (2.6 , 0, 0) -- (2.6, 1.3, 0);
  %% \draw[axis] (2.6 , 0, 0) -- (2.6, -1.3, 0) node [left] {$B_y$};
  %% \draw[axis] (2.6 , 0, 0) -- (2.6, 0, 1.3) node [above] {$B_z$};
  
  \coordinate (bl) at (-1.0, -0.70711, 0.70711);
  \coordinate (bnl) at (-1.0, 0, 0);
  \coordinate (btl) at (0, 0.81, 0.57);
  \coordinate (btr) at (0, -0.70711, 0.70711);
  \coordinate (bnr) at (1.0, 0, 0);
  \coordinate (br) at (1.0, 0.70711, 0.70711);

  \pgfmathsetmacro{\psil}{55};
  \pgfmathsetmacro{\psir}{-45};

  \draw[->,darkred, line width=2pt] (O) -- (btl) node[black,right] {$\mbf{B}_{tl}$};
  \draw[->,darkblue, line width=2pt] (O) -- (btr) node[black,left] {$\mbf{B}_{tr}$};

  %define the rotated coordinate frame to lie in the "theta plane"
  \tdplotsetthetaplanecoords{90};

  % angles
  \tdplotdrawarc[->,line width=1pt,tdplot_rotated_coords,left]{(0.0,0.0,0.0)}{0.55}{90}{\psil}
                {anchor=east}{\small$\psi_l$};

  \tdplotdrawarc[line width=1pt,tdplot_rotated_coords,left]{(0.0,0.0,0.0)}{0.35}{90}{\psil}
                {anchor=east}{\small$\psi_r$};

  \tdplotdrawarc[->,line width=1pt,tdplot_rotated_coords,left]{(0.0,0.0,0.0)}{0.35}{\psil}{\psir}
                {anchor=north west}{};

  \tdplotdrawarc[->,line width=1pt,tdplot_rotated_coords,left]{(0.0,0.0,0.0)}{0.65}{\psil}{\psir}
                {anchor=north }{};
  \node[draw=white,below] at (0,0.20521,0.56382) {\small $\alpha$};

  \draw[->,darkred, line width=2pt] (bnl) -- (O); 
  \draw[->,darkblue, line width=2pt] (O) -- (bnr);

  \node[draw = white,above] at (0.95,-0.1,0) {$\mbf{B}_{nr}$};
  \node[draw = white,below] at (-0.25,0.1,0) {$\mbf{B}_{nl}$};

\end{tikzpicture}
